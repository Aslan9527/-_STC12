C51 COMPILER V9.59.0.0   MAIN                                                              07/04/2020 10:12:45 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <STC12C5A60S2.h>
   2          #include <LCD1602.h>
   3          #include <ADC.h>
   4          #include <usart.h>
   5          #include <string.h>
   6          #include <intrins.h>
   7          #define uchar unsigned  char
   8          #define uint  unsigned  int
   9          
  10          #define FSCLK 11059200
  11          //#define FSCLK 12000000
  12          
  13          sbit moto=P1^1;//ÉùÃ÷¼ÌµçÆ÷Á¬½ÓÒý½ÅP11
  14          float res0,res1;//res0µ±Ç°µçÑ¹£¬res1Éè¶¨µçÑ¹
  15          uchar a,b,c;
  16          
  17          uchar data_buffer[20],data_length = 0,flag = 0;//data_buffer´®¿Ú½ÓÊÕ»º´æÊý×é¡¢data_lengthÊý×é³¤¶È¡¢flag½ÓÊ
             -Õ±êÖ¾
  18          /**************ÃüÁî¼¯*************/
  19          uchar table0[8]="SetValue";//ÃüÁî1
  20          uchar table1[16]={'S','e','t','V','a','l','u','e',':','x','.','x','x','O','K','.'};//·µ»Ø1
  21          uchar table2[5]="Start";//ÃüÁî2
  22          uchar table3[10]="Operating.";//·µ»Ø2
  23          uchar table4[4]="Stop";//ÃüÁî3
  24          uchar table5[7]="Stoped.";//·µ»Ø3
  25          /*********************************************************************************************************
  26          ** º¯Êý¹¦ÄÜ £ºÑÓÊ±º¯Êý
  27          ** º¯ÊýËµÃ÷ £ºÀûÓÃÈí¼þÑÓÊ±£¬Õ¼ÓÃCPU£¬¾­µ÷ÊÔ×îÐ¡µ¥Î»´óÔ¼Îª1ms
  28          ** Èë¿Ú²ÎÊý £ºtime:ÐèÒªÑÓÊ±µÄÊ±¼ä£¬µ¥Î»ms
  29          ** ³ö¿Ú²ÎÊý £ºÎÞ
  30          *********************************************************************************************************/
  31          void Delay_ms(uint time)
  32          {
  33   1        uint i,j;
  34   1        for(i = 0;i < time;i ++)
  35   1          for(j = 0;j < 930;j ++);
  36   1      }
  37          /*********************************************************************************************************
  38          ** º¯Êý¹¦ÄÜ £ºµ±Ç°µçÑ¹ÏÔÊ¾º¯Êý
  39          ** º¯ÊýËµÃ÷ £ºÏÔÊ¾µ±Ç°µçÑ¹
  40          ** Èë¿Ú²ÎÊý £ºÎÞ
  41          ** ³ö¿Ú²ÎÊý £ºÎÞ
  42          *********************************************************************************************************/
  43          void Display_Now_U()
  44          {
  45   1          Write_1602_String("NOW:U=",0x80);//µÚÒ»ÐÐµÚ1¸ö×Ö·ûÎ»ÖÃ¿ªÊ¼ÏÔÊ¾
  46   1          Write_1602_Data(0x30 + (uint)res0%10);
  47   1          Write_1602_Data('.');
  48   1          Write_1602_Data(0x30 + (uint)(res0*10)%10);
  49   1          Write_1602_Data(0x30 + (uint)(res0*100)%10);
  50   1          Write_1602_Data('V');
  51   1      }
  52          /*********************************************************************************************************
  53          ** º¯Êý¹¦ÄÜ £ºÉè¶¨µçÑ¹ÏÔÊ¾º¯Êý
  54          ** º¯ÊýËµÃ÷ £ºÏÔÊ¾Éè¶¨µçÑ¹
C51 COMPILER V9.59.0.0   MAIN                                                              07/04/2020 10:12:45 PAGE 2   

  55          ** Èë¿Ú²ÎÊý £ºÎÞ
  56          ** ³ö¿Ú²ÎÊý £ºÎÞ
  57          *********************************************************************************************************/
  58          void Display_Set_U()
  59          {
  60   1          Write_1602_String("SET:U=",0x80+0x40);//µÚ¶þÐÐµÚ1¸ö×Ö·ûÎ»ÖÃ¿ªÊ¼ÏÔÊ¾
  61   1          Write_1602_Data(0x30 + (uint)res1%10);
  62   1          Write_1602_Data('.');
  63   1          Write_1602_Data(0x30 + (uint)(res1*10)%10);
  64   1          Write_1602_Data(0x30 + (uint)(res1*100)%10);
  65   1          Write_1602_Data('V');
  66   1      }
  67          /*********************************************************************************************************
  68          ** º¯Êý¹¦ÄÜ £º´®¿ÚÃüÁî·ÖÎöº¯Êý
  69          ** º¯ÊýËµÃ÷ £º·ÖÎö´®¿ÚÃüÁî
  70          ** Èë¿Ú²ÎÊý £º´®¿Ú»º´æÊý×é¡¢ÃüÁî¼¯Êý×é¡¢³¤¶È
  71          ** ³ö¿Ú²ÎÊý £ºÎÞ
  72          *********************************************************************************************************/
  73          int Analysis(char *S,char *D,char LEN)
  74          {
  75   1      int n;
  76   1      for(n=0;n<LEN;n++)
  77   1      if(S[n]!=D[n]) return 1;//Èç¹ûÊý×é²»ÏàÍ¬·µ»Ø1
  78   1      return 0;//ÏàÍ¬·µ»Ø0
  79   1      }
  80          
  81          void main()
  82          {
  83   1      
  84   1        LCD_1602_Init(); //Òº¾§ÏÔÊ¾¡¢³õÊ¼»¯
  85   1        ADC_Init(ADC_PORT0); //ÅäÖÃÍ¨µÀP1^0ÎªAD²É¼¯¿Ú
  86   1        USART_Init();//´®¿Ú³õÊ¼»¯
  87   1        moto=1;//¼ÌµçÆ÷³õÊ¼×´Ì¬ÖÃ1
  88   1        res1=1.28;//³õÊ¼Éè¶¨µçÑ¹1.28V
  89   1      
  90   1        while(1)
  91   1        {
  92   2          res0=GetADCResult(ADC_CH0); //»ñÈ¡AD×ª»»µçÑ¹
  93   2          Display_Now_U();//ÏÔÊ¾µ±Ç°µçÑ¹
  94   2          Display_Set_U();//ÏÔÊ¾Éè¶¨µçÑ¹
  95   2          if(flag==1)//Èç¹û½ÓÊÕµ½ÁË´®¿ÚÊý¾Ý
  96   2          {
  97   3            flag=0;//ÇåÁã½ÓÊÕ±êÖ¾
  98   3            
  99   3            a=Analysis(data_buffer,table0,8) ;//ÅÐ¶ÏÊÇ²»ÊÇ"SetValue"ÃüÁî
 100   3            b=Analysis(data_buffer,table2,5) ;//ÅÐ¶ÏÊÇ²»ÊÇ"Start"ÃüÁî
 101   3            c=Analysis(data_buffer,table4,4) ;//ÅÐ¶ÏÊÇ²»ÊÇ"Stop"ÃüÁî
 102   3              if(a==0)//ÊÇtable0ÃüÁî
 103   3            {
 104   4               table1[10]=data_buffer[9];//»ñÈ¡Éè¶¨µçÑ¹Öµ¸öÎ»
 105   4               table1[12]=data_buffer[10];//»ñÈ¡Éè¶¨µçÑ¹ÖµÐ¡ÊýµãºóµÚ1Î»
 106   4               table1[13]=data_buffer[11];//»ñÈ¡Éè¶¨µçÑ¹ÖµÐ¡ÊýµãºóµÚ2Î»
 107   4               Send_String(table1,16);//·µ»ØÓ¦´ð¡°SetValue£ºx.xxOK.¡±
 108   4               res1=data_buffer[9]+0.1*data_buffer[10]+0.01*data_buffer[11];//Éè¶¨µçÑ¹Öµ¸³¸øres1          
 109   4               a=1;
 110   4            }
 111   3              if(b==0)//Èç¹ûÊÇ"Start"ÃüÁî
 112   3            {
 113   4               Send_String(table3,10);//·µ»ØÓ¦´ð"Operating."
 114   4               moto=0;//Æô¶¯¼ÌµçÆ÷         
 115   4               b=1;       
 116   4            
C51 COMPILER V9.59.0.0   MAIN                                                              07/04/2020 10:12:45 PAGE 3   

 117   4            }
 118   3              if(c==0)////Èç¹ûÊÇ"Stop"ÃüÁî
 119   3            {
 120   4               Send_String(table5,7);//·µ»ØÓ¦´ð"Stoped."
 121   4               moto=1;//¹Ø±Õ¼ÌµçÆ÷         
 122   4               c=1;             
 123   4            }     
 124   3           
 125   3          }
 126   2            
 127   2          Delay_ms(10);//ÑÓÊ±10ms 
 128   2        } 
 129   1      }
 130          
 131          /************************** (C) *****END OF FILE*****************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    977    ----
   CONSTANT SIZE    =     78    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     84      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
